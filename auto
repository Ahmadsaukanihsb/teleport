local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")

local BACKEND_URL = "https://backend-vercel-ashy.vercel.app/api/latest-user.js"

local function fetchLatestUser()
    local success, response = pcall(function()
        -- curl GET request via HttpService:GetAsync
        return HttpService:GetAsync(BACKEND_URL, true)
    end)
    if success then
        local data = HttpService:JSONDecode(response)
        return data.username, data.instanceId
    else
        warn("Failed to fetch latest user: " .. tostring(response))
        return nil, nil
    end
end

local function autoJoin()
    local username, instanceId = fetchLatestUser()
    if not username or not instanceId then
        warn("No latest user or instance found.")
        return
    end

    local localPlayer = Players.LocalPlayer
    if localPlayer.Name == username then
        print("You are already in the latest instance.")
        return
    end

    -- Check if already in that instance
    if game.JobId == instanceId then
        print("Already connected to the latest instance.")
        return
    end

    print(string.format("Teleporting to user %s in instance %s...", username, instanceId))

    -- Teleport to the latest instance
    TeleportService:TeleportToPlaceInstance(game.PlaceId, instanceId, localPlayer)
end

-- Run the autoJoin function
autoJoin()
