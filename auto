local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local placeId = game.PlaceId
local currentInstanceId = game.JobId
local backendUrlBase = "https://backend-vercel-ashy.vercel.app/api/instance.js?username="

local CHECK_INTERVAL = 10 -- detik cek instance baru

local function getLatestInstance(username)
    local url = backendUrlBase .. HttpService:UrlEncode(username)
    local success, response = pcall(function()
        return HttpService:GetAsync(url)
    end)

    if success then
        local data = HttpService:JSONDecode(response)
        if data and data.instanceId then
            return data.instanceId
        end
    else
        warn("Failed to get latest instance:", response)
    end
    return nil
end

while true do
    local latestInstance = getLatestInstance(player.Name)
    if latestInstance and latestInstance ~= currentInstanceId then
        print("Teleporting to new instance:", latestInstance)
        TeleportService:Teleport(placeId, player, latestInstance)
        break
    end
    wait(CHECK_INTERVAL)
end
