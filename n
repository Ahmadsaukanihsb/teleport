local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

-- Konfigurasi
local REDIS_API_URL = "https://gentle-bengal-35395.upstash.io"  -- Ganti dengan URL endpoint Redis Anda
local MAX_RETRIES = 5
local RETRY_DELAY = 10
local PLACE_ID = 126884695634066  -- Ganti dengan ID game target

-- Fungsi untuk mendapatkan instanceId dari Redis
local function getInstanceFromRedis()
    local httpRequest = (syn and syn.request) or (http_request or request or (fluxus and fluxus.request) or http)
    
    if not httpRequest then
        warn("Executor tidak mendukung HTTP request!")
        return nil
    end

    local response = httpRequest({
        Url = REDIS_API_URL,
        Method = "GET"
    })

    if response and response.StatusCode == 200 then
        local data = HttpService:JSONDecode(response.Body)
        return data.instanceId
    else
        warn("Gagal mendapatkan instanceId dari Redis:", response and response.StatusCode or "No response")
        return nil
    end
end

-- Fungsi untuk join ke instance
local function joinInstance(instanceId)
    local success, err = pcall(function()
        TeleportService:TeleportToPlaceInstance(PLACE_ID, instanceId, Players.LocalPlayer)
    end)
    
    if not success then
        warn("Gagal join ke instance:", err)
        return false
    end
    return true
end

-- Fungsi utama auto joiner
local function autoJoin()
    local retries = 0
    
    while retries < MAX_RETRIES do
        retries = retries + 1
        print("Mencoba bergabung... Percobaan ke-"..retries)
        
        local instanceId = getInstanceFromRedis()
        if instanceId then
            print("Mendapatkan instanceId:", instanceId)
            if joinInstance(instanceId) then
                print("Berhasil memulai proses join!")
                return
            end
        else
            print("Tidak mendapatkan instanceId dari Redis")
        end
        
        if retries < MAX_RETRIES then
            wait(RETRY_DELAY)
        end
    end
    
    warn("Gagal bergabung setelah "..MAX_RETRIES.." percobaan")
end

-- Mulai proses auto join
autoJoin()
